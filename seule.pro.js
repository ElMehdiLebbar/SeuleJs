"use strict";class Seule{constructor(a){this.el=document.querySelectorAll(a.el),this.child=!1,this.data=a.data||{};let b;this.shadow=()=>{let b,c=this.el[0];class d extends HTMLElement{constructor(){super();const d=this.attachShadow({mode:"closed"});let e=document.createElement("link");e.setAttribute("rel","stylesheet"),a.style&&e.setAttribute("href",a.style+".css"),d.appendChild(e);let f=c.cloneNode(!0);c.innerHTML="",d.appendChild(f),b=d.children[1]}}customElements.define("seule-"+a.el.replace("#",""),d);let e=document.createElement("seule-"+a.el.replace("#",""));c.appendChild(e),this.child=b},this.ren=a=>{let b=Object.keys(this.data),c=a||this.child.innerHTML;for(let d of b)for(;c.includes("{{"+d+"}}");)c=c.replace("{{"+d+"}}",this.data[d]);this.child.innerHTML=c},this.shadow(),b=this.child.innerHTML,this.old=b,this.ren(),a.root&&this.Root(),a.handler&&a.handler(this,a=>this.Find(a)),a.htmlMethods&&this.HtmlMethods()}Find(a){let b=this.child,c=this;class d{constructor(a){try{this.el=b.querySelectorAll(a)}catch(b){this.el=a.length?a:[a]}}Each(a){for(const b of this.el)a.call(b);return this}On(a,b){return"hold"===a?void this.Hold(b):this.Each(function(){this.addEventListener(a,()=>b(new d(this),this),!1)})}Click(a){return this.On("click",b=>a(b)),this}Hold(a,b){return b=b||"1.5s",this.Each(function(){let c=!1,e="ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints,f=e?"touchstart":"mousedown",g=e?"touchend":"mouseup";this.addEventListener(f,function(f){c=!0,setTimeout(function(){c&&a(new d(f),f)},1e3*parseFloat(b.replace(/s/g,"")))}),this.addEventListener(g,function(){c=!1})})}Focus(a){return a?this.On("focus",b=>a(b)):this.el[0].focus(),this}Blur(a){return a?this.On("blur",b=>a(b)):this.el[0].blur(),this}Swipe(a,b){function c(a){g=a.touches[0].clientX,h=a.touches[0].clientY}function f(c){if(g&&h){let e=c.touches[0].clientX,f=c.touches[0].clientY,i=g-e,j=h-f;if(Math.abs(i)>Math.abs(j)){if(0<i){if("left"===a)b(new d(this),this);else return!1;}else if(0>i)if("right"===a)b(new d(this),this);else return!1;}else if(0<j){if("top"===a)b(new d(this),this);else return!1;}else if(0>j)if("bottom"===a)b(new d(this),this);else return!1;g=null,h=null}}let g,h,i=this.el;for(let d of i)d.addEventListener("touchstart",c,!1),d.addEventListener("touchmove",f,!1);return this}HotKey(a,b){let c,e="",f={Arrow:"",Control:"ctrl"},g=a.replace(/\s/g,"");return this.Each(function(){this.addEventListener("keydown",function(a){e+=a.key,e=e.replace(/Arrow|Control/gi,function(a){return f[a]}),c=e.toLowerCase().indexOf(g.toLowerCase()),-1<c&&(b(new d(this),this),e=""),setInterval(()=>e="",5e3)},!0)})}Copy(a,c){let d=b.querySelector(a),e=c.split(":");for(let b of e)this.On(b.trimStart().trimEnd(),function(){let a=new MouseEvent(b.trimStart().trimEnd(),{view:window,bubbles:!0,cancelable:!0});d.dispatchEvent(a)});return this}Toggle(a,b){let c=!0;return this.On(a,function(a){return!0===c?(b.handler(a),void(c=!1)):void(b.callback(a),c=!0)}),this}Classes(a){let b={},c=b=>{for(const c of this.el)c.classList[b](a)},d=["add","remove","toggle"];b.list=[];for(const c of this.el[0].classList)b.list.push(c);b.contains=()=>this.el[0].classList.contains(a);for(let e of d)b[e]=()=>(c(e),this);return b}Css(a,b){return"object"==typeof a?this.Each(function(){this.style.cssText=d.objectToStyle(a)}):b?this.Each(function(){this.style[a]=b}):getComputedStyle(this.el[0])[a]}Visible(){return{showing:()=>{for(let a of this.el)a.style.visibility="visible";return this},hidden:()=>{for(let a of this.el)a.style.visibility="hidden";return this},status:()=>"hidden"!==this.el[0].style.visibility}}Show(){return this.Each(function(){let a=getComputedStyle(this).display;"none"===a&&(this.style.display="inherit")})}Hide(){return this.Each(function(){this.style.display="none"})}Opacity(a){return a?this.Each(function(){this.style.opacity=a}):this.el[0].style.opacity}Anime(a){if(a){let b=Object.keys(a),c={},e={},f={},g={},h={};for(const d of b){"object"==typeof a[d]||"duration property direction loop time delay text".includes(d)||(a[d]={value:a[d]});let b=a[d].delay||"0s",i=a[d].duration||a.duration||"0.7s";if(!"duration property direction loop time delay text".includes(d)){let j=getComputedStyle(this.el[0]);c[d]=i+" "+b,e[d]=a[d].value||"inherit",g===h&&(g[d]=j[d]||"inherit"),f[d]=parseFloat(b.replace(/s/g,""))+parseFloat(i.replace(/s/g,""))}}e.transition=d.objectToStyle(c).replace(/:/g," ").replace(/;/g,", "),e["transition-timing-function"]=a.type||"ease",a.property&&(e["transition-property"]=a.property),a.loop||a.direction||(a.duration&&(e["transition-duration"]=a.duration),a.delay&&(e["transition-delay"]=a.delay)),g.transition=e.transition,g["transition-timing-function"]=e["transition-timing-function"],a.property&&(g["transition-property"]=e["transition-property"]),a.duration&&(g["transition-duration"]=e["transition-duration"]),a.delay&&(g["transition-delay"]=e["transition-delay"]),g===h&&(h=g);let i=Object.values(f);return f=1e3*Math.max(...i),this.Each(function(){function b(a,b){h.setAttribute("style",d.objectToStyle(e)),setTimeout(()=>{h.setAttribute("style",d.objectToStyle(g))},parseInt(a)),b&&(i++,b<=i&&clearInterval(c))}let c,h=this,i=1,j=100;(a.loop||a.direction)&&a.delay&&(j=1e3*parseFloat(a.delay.replace(/s/g,"")));let k=2*parseInt(f+j)+100;a.direction||a.loop?(b(f+j),c=setInterval(function(){a.time?b(f+j,a.time):b(f+j)},k),a.direction&&clearInterval(c)):h.setAttribute("style",d.objectToStyle(e))})}return this.Each(function(){this.style.transition="all ease 0.7s"})}Width(a){return a?this.Each(function(){this.style.width=a}):getComputedStyle(this.el[0]).width}Height(a){return a?this.Each(function(){this.style.height=a}):getComputedStyle(this.el[0]).height}Attr(a){return{set:b=>{for(const c of this.el)c.setAttribute(a,b);return this},remove:()=>{for(const b of this.el)b.removeAttribute(a);return this},get:()=>this.el[0].getAttribute(a),has:()=>this.el[0].hasAttribute(a)}}Text(a){return d.CONTENT("Text",a,this)}Html(a){return d.CONTENT("HTML",a,this)}Val(a){return{set:()=>{for(const b of this.el)b.value=a;return this},get:()=>this.el[0].value}}ScrollPosition(a){return a?this.el[0].pageXOffset||this.el[0].scrollLeft:this.el[0].pageYOffset||this.el[0].scrollTop}Scroll(){const a=(a,c)=>{const d=a,e=c,f=d.scrollTop;let g=e.offsetTop-d.scrollTop;f<e.offsetTop&&e.offsetTop>d.scrollHeight-d.clientHeight&&(g=d.scrollHeight-d.clientHeight-d.scrollTop);let h=0;const i=Math.round(30);(function a(){d.scrollTop=b(h,f,g,i),h++,h<i&&requestAnimationFrame(a)})()},b=(a,b,c,d)=>c*(Math.pow(a/d-1,3)+1)+b;if("fixed"===getComputedStyle(this.el[0].parentElement).position)a(this.el[0].parentNode,this.el[0]);else{const b=document.documentElement||document.body;a(b,this.el[0])}return this}Delay(a,b){return this.Each(function(){setTimeout(()=>{a(new d(this))},b||1e3)})}static CONTENT(a,b,c){return{get:()=>c.el[0]["inner"+a],set:()=>{for(let d of c.el)d["inner"+a]=b;return this},append:d=>{for(let e of c.el)e["insertAdjacent"+a](d||"beforeend",b);return this}}}static objectToStyle(a){let b=Object.keys(a).map(b=>b+": "+a[b]).join(";");return("'"+b+"'").slice(1).slice(0,-1)}}return new d(a)}HtmlMethods(){let a=this.child.querySelectorAll("*");for(const b of a){let c=this.Find(b),d=b.getAttributeNames(),e=c;if(d.includes("@find")&&(e=this.Find(b.getAttribute("@find"))),d.includes("@copy")){let c=b.getAttribute("@copy").split(/:(.+)/);e.Copy(c[0],c[1])}for(const f of d)if(f.includes("@")){let a=b.getAttribute(f),d=a.split(";"),g=f.replace("@","");"ready"===g&&(g="load",c=this.Find(window)),c.On(g,()=>{for(const a of d){let b=a,c=a.split("("),d=b.substring(b.indexOf("(")+1),f=d.slice(0,-1).split(/:(.+)/),g=c[0].trim().replace(/\w/,a=>a.toUpperCase()),h=d.slice(0,-1).replace(/[~']/g,"\"").replace(/[~`]/g,"\"");if(h.includes("{")&&(h=JSON.parse(h)),"Attr".includes(g)&&f[0].includes("set")){let a=f[1].split("="),b=a[1].trim().replace(/[~']/g,"").replace(/[~`]/g,"");e[g](a[0].trim())[f[0].trim()](b)}"Text, Classes, Attr, Val".includes(g)&&e[g](f[1].trim())[f[0].trim()](),"Anime, Css, Show, Hide, Width, Height, Visible, Opacity".includes(g)&&("Visible"===g?"true"===h?e.Visible().showing():e.Visible().hidden():e[g](h))}}),b.removeAttribute(f)}}}Root(a){let b=decodeURI(window.location.href).split("?");b=b[1].split("&"),a&&(a=a.split("&"));for(let c of b){if(a)for(let b of a){let a=b.split("="),d=c.split("=");a[0]===d[0]&&(c=b)}let b=c.split("=");this.data[b[0]]=b[1]+""}return this.ren(this.old),this}async Get(a,b){b||(b={});let c=this.child,d=new FormData;if(b.param={method:b.method||"get"},b.form){let a=c.querySelector(b.form);d=new FormData(a),a.onsubmit=async a=>a.preventDefault()}if(b.file)if("object"==typeof b.file)for(const a of b.file){let b;b="object"==typeof a?a:c.querySelector(a),d.append(b.name,b.files[0])}else b.file=c.querySelector(b.file),d.append(b.file.name,b.file.files[0]);b.data&&Object.keys(b.data).forEach(a=>d.append(a,b.data[a])),"post"===b.method&&(b.param.body=d);let e=await fetch(a,b.param);return e.ok?b.blob?await e.blob():b.json?await e.json():await e.text():"HTTP-Error: "+e.status}async Post(a,b){return b.method="post",await this.Get(a,b)}static Store(a){return{set:b=>(window.localStorage.setItem(a,JSON.stringify(b)),this),get:()=>JSON.parse(window.localStorage.getItem(a)),remove:()=>(window.localStorage.removeItem(a),this),reset:()=>(window.localStorage.clear(),this)}}static Audio(a){let b={};return b.Delay=0,b.Element=new Audio(a),b.Src=a,b.Play=function(a){return b.Delay=1e3*a,setTimeout(function(){b.Element.pause(),b.Element.play()},b.Delay),this},b.Stop=function(a){return setTimeout(function(){b.Element.pause(),b.Element.currentTime=0},1e3*a),this},b.Pause=function(a){return setTimeout(function(){b.Element.pause()},1e3*a),this},b}static Date(a){let b={};return b.Increase=function(c,d){let e=new Date(a),f=new Date(e.setMonth(e.getMonth()+parseInt(d))),g=f.getMonth()+1;if(!c)b.current=f.getFullYear()+"-"+("0"+g).slice(-2)+"-"+("0"+f.getDate()).slice(-2);else if("day"===c.toLowerCase()){let c=new Date(a);c.setDate(c.getDate()+parseInt(d)),b.current=c.getFullYear()+"-"+("0"+(c.getMonth()+1)).slice(-2)+"-"+("0"+c.getDate()).slice(-2)}else g=e.getFullYear()+1,b.current=g+"-"+("0"+e.getMonth()).slice(-2)+"-"+("0"+e.getDate()).slice(-2);return b.res=b.current,this},b.BetWeen=function(a){let d=b.current||b.Increase("day",0).current,e=a.from.split(a.character||"-"),f=a.to.split(a.character||"-"),g=d.split(a.character||"-");return(a.from=new Date(e[0],parseInt(e[1])-1,e[2]),a.to=new Date(f[0],parseInt(f[1])-1,f[2]),d=new Date(g[0],parseInt(g[1])-1,g[2]),d>a.from&&d<a.to)?(a.handler&&a.handler(),b.res=!0,this):(a.callback&&a.callback(),b.res=!1,this)},b}static Scroll(){let a={};return a.top=()=>{const b=document.documentElement.scrollTop||document.body.scrollTop;return 0<b&&(window.requestAnimationFrame(a.top),window.scrollTo(0,b-b/8)),this},a.bottom=()=>{const b=document.documentElement.scrollTop||document.body.scrollTop,c=document.body.scrollHeight;return window.innerHeight+window.scrollY>=document.body.offsetHeight?void window.scrollTo(0,b+c/40):(window.requestAnimationFrame(a.bottom),window.scrollTo(0,b+c/40),this)},a}static Orientation(){return"90"==screen.orientation.angle?"Horizontally":"Vertically"}static Screen(a,b){function c(a){return a.matches?b.handler&&b.handler():b.callback&&b.callback(),a}let d=window.matchMedia(a),e=c(d);return d.addEventListener("change",c),e}static Print(a){let b=a.title||"",c=new Seule("body");c.Append("<iframe class=\"seule--frame\" name=\"sframe\" style=\"position: fixed; bottom: -100%\"></iframe>");let d=document.getElementsByClassName("seule--frame")[0],e=d.contentWindow?d.contentWindow:d.contentDocument.document?d.contentDocument.document:d.contentDocument;e.document.open(),e.document.write("<html><head><title>"+b+"</title>"),e.document.write("</head><body>"),a.style&&e.document.write("<link href=\""+a.style+".css\" rel=\"stylesheet\" type=\"text/css\" />"),e.document.write(a.template),e.document.write("</body></html>"),e.document.close(),setTimeout(function(){window.frames.sframe.focus(),window.frames.sframe.print()},500)}SceneHandler(a){function b(a){let b;try{b=c.querySelector(a.selector)}catch(c){b=a.selector}let d,e=a.unit||"percent",f=a.distance,g=window.innerHeight||document.documentElement.clientHeight,h=b.getBoundingClientRect().top,i=Math.round(100*(h/g)),j=Math.round(h);d="percent"==e?i:j,d<=f?a.handler():a.callback&&a.callback()}let c=this.child;return window.addEventListener("scroll",function(){b(a)},!1),this}Scene(a){let b=0;return this.SceneHandler({selector:a.selector,distance:a.distance||0,unit:a.unit||"percent",handler:()=>{0===b&&(a.handler(),b=1)},callback:()=>{1===b&&a.callback&&(a.callback(),b=0)}}),this}static PDO(a,b){b&&!b.query&&(b.query=a=>a);let c=[...a],d=[],e=[],g={},h=()=>{if(b){let a=c.filter((a,c)=>("remove duplicates"===b.execute||b.columns||(a.index=c),b.child&&"insert"!==b.execute||"insert"===b.execute&&b.nest?a[b.child].some((a,c)=>b.query(a,c)):b.query(a,c)));if(b.child){for(const a of c)for(const c of a[b.child])"remove duplicates"!==b.execute&&(c.parent=a.index),d.push(c);e=d,d=d.filter((a,c)=>b.query(a,c))}return a}};if(g.alter=(b,d,e)=>(e=e||a,e.map(function(a){let e=a;if("object"==typeof d&&"replace"===b.toLowerCase()&&(e[d[1]]=e[d[0]],delete e[d[0]]),"drop"===b.toLowerCase())for(const a of d)delete e[a];if("add"===b.toLowerCase())for(const a of d)e.hasOwnProperty(a)||(e[a]="");return e}),g),g.group=(b,c)=>{c=c||a;let d=[],e=[...new Set(c.reduce((c,d)=>c.concat(d[b]),[]))];for(const a of e){d.push(JSON.parse("{\""+b+"\":\""+a+"\"}"))}return g.res=d,g},g.removeDpl=(b,c)=>{c=c||a;for(let a of c)delete a.index;if(b){let a=new Set;return c.filter(c=>!a.has(c[b])&&a.add(c[b]))}let d=new Set(c.map(JSON.stringify));return g.res=Array.from(d).map(JSON.parse),g},g.sum=b=>(b=b||a,g.res=b.reduce((a,b)=>Object.keys(b).reduce((a,c)=>(a[c]=(a[c]||0)+ +b[c],a),a),{}),g),g.sort=(c,d)=>{return d=d||a,g.res=d.sort((()=>(d,a)=>d[c]>a[c]?1:d[c]<a[c]?-1:0)(c)),g},g.res=h(),g.child=d,b){switch(b.execute){case"update":let c=Object.keys(b.item)||{};g.res.forEach(d=>a.findIndex(a=>{if(a===d)for(const d of c)if(b.nest)for(const a of g.child)a[d]=b.item[d];else a[d]=b.item[d]}));break;case"delete":if(g.child.forEach(a=>e.splice(e.findIndex(b=>b===a),1)),b.nest){g.res.forEach(a=>a[b.child].findIndex(c=>{for(const d of g.child)c===d&&a[b.child].splice(a[b.child].findIndex(a=>a===d),1)})),g.res=a;break}g.res.forEach(b=>a.splice(a.findIndex(a=>a===b),1));break;case"insert":if(b.child)for(const c of g.res)"object"!=typeof c[b.child]&&(c[b.child]=[]),b.item.parent=c.index,a[c.index][b.child].push(b.item),e.push(b.item);else a.push(b.item);}if("select"!==b.execute&&(g.res=a,g.child=e),b.template){let a=g.res,c={};if(g.res||(a=g),b.nest&&(a=g.child),b.component){let d=(c,d)=>{c=c||a,d.innerHTML="";for(const e of a){let a=document.createElement("s-bind");if(a.innerHTML=b.template(e),d.appendChild(a),1===b.style.length){let a=document.createElement("link");a.setAttribute("rel","stylesheet"),a.setAttribute("href",b.style[0]+".css"),d.appendChild(a)}else{let a=document.createElement("style");a.textContent=b.style,d.appendChild(a)}}};class e extends HTMLElement{constructor(){super();const e=this.attachShadow({mode:b.mode||"open"});d(a,e);let f=(b,c,f)=>{b=b||a,d(b,e,c,f)};"closed"===b.mode?c.Select=()=>console.log("mode is closed! to use Select method, Switch to the open Mode!"):(c=b.element,c.Select=a=>b.find(e.querySelectorAll(a))),b.handler&&b.handler(c,a,f)}}customElements.define(b.selector,e)}}}return g}Component(a,b){let c=this.Find(a),d=a=>this.Find(a);return b.data&&!b.data.length&&(b.obj=[],b.obj.push(b.data),b.data=b.obj),Seule.PDO(b.data||[{}],{find:a=>d(a),element:c,component:!0,mode:b.mode,style:b.style||"",execute:b.execute||!1,child:b.child||!1,columns:b.columns||!1,nest:b.nest||!1,item:b.item||!1,action:b.action||!1,selector:a,query(a){return b.query?b.query(a):a},template(a){return b.template(a)||""},handler(a,c,d){b.handler&&b.handler(a,c,d)}}),this}}
